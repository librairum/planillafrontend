<div class="base-afectacion-container">
  <!-- Toast para notificaciones -->
  <p-toast></p-toast>

  <!-- Confirm Dialog -->
  <p-confirmDialog></p-confirmDialog>

  <p-panel header="Base de Afectación" styleClass="shadow-xl rounded-xl mb-3">

    <div class="flex justify-content-between align-items-center mb-3">
      <button pButton type="button"
                icon="pi pi-plus"
                class="p-button-sm add-button"
                (click)="agregarNuevo()"
                label="Nueva Base de Afectación"
                pTooltip="Agregar nueva base de afectación"
                tooltipPosition="bottom"></button>
    </div>

    <p-table
      #dt
      [value]="basesAfectacion"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[5, 10, 20, 50]"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} bases de afectación"
      [globalFilterFields]="['codigo', 'descripcion', 'alias']"
      [tableStyle]="{ 'min-width': '100%' }"
      styleClass="base-afectacion-table p-datatable-sm p-datatable-striped p-datatable-gridlines">

      <!-- Columnas -->
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 100px">Codigo</th>
          <th>Descripcion</th>
          <th style="width: 100px">Posicion</th>
          <th style="width: 150px">Alias</th>
          <th style="width: 80px; text-align: center">Activo</th>
          <th style="width: 80px; text-align: center">Sunat</th>
          <th style="width: 200px; text-align: center">Acciones</th>
        </tr>
      </ng-template>

      <!-- Filas -->
      <ng-template pTemplate="body" let-base let-rowIndex="rowIndex">
        <tr>
          <!-- Código -->
          <td>
            <input
              *ngIf="base.isEditing"
              type="text"
              pInputText
              [(ngModel)]="base.codigo"
              [disabled]="!base.isNew"
              class="table-input"
              maxlength="10" />
            <span *ngIf="!base.isEditing">{{ base.codigo }}</span>
          </td>

          <!-- Descripción -->
          <td>
            <input
              *ngIf="base.isEditing"
              type="text"
              pInputText
              [(ngModel)]="base.descripcion"
              class="table-input"
              maxlength="150" />
            <span *ngIf="!base.isEditing">{{ base.descripcion }}</span>
          </td>

          <!-- Posición -->
          <td>
            <input
              *ngIf="base.isEditing"
              type="number"
              pInputText
              [(ngModel)]="base.posicion"
              class="table-input" />
            <span *ngIf="!base.isEditing">{{ base.posicion }}</span>
          </td>

          <!-- Alias -->
          <td>
            <input
              *ngIf="base.isEditing"
              type="text"
              pInputText
              [(ngModel)]="base.alias"
              class="table-input"
              maxlength="50" />
            <span *ngIf="!base.isEditing">{{ base.alias }}</span>
          </td>

          <!-- Activo (checkbox) -->
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="base.activo"
              [binary]="true"
              [disabled]="!base.isEditing"
              inputId="activo-{{rowIndex}}">
            </p-checkbox>
          </td>

          <!-- Sunat (checkbox) -->
          <td class="text-center">
            <p-checkbox
              [(ngModel)]="base.sunat"
              [binary]="true"
              [disabled]="!base.isEditing"
              inputId="sunat-{{rowIndex}}">
            </p-checkbox>
          </td>

          <!-- Acciones -->
          <td class="actions-cell">
            <div class="action-buttons">
              <!-- Botón Editar -->
              <button
                pButton
                type="button"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-text p-button-sm"
                (click)="editar(base)"
                pTooltip="Editar"
                tooltipPosition="top">
              </button>

              <!-- Botón Eliminar -->
              <button
                pButton
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-text p-button-sm p-button-danger"
                (click)="eliminar(base, rowIndex)"
                pTooltip="Eliminar"
                tooltipPosition="top">
              </button>

              <!-- Botón Cancelar -->
              <button
                pButton
                type="button"
                icon="pi pi-undo"
                class="p-button-rounded p-button-text p-button-sm p-button-secondary"
                (click)="cancelar(base, rowIndex)"
                [disabled]="!base.isEditing"
                pTooltip="Cancelar"
                tooltipPosition="top">
              </button>

              <!-- Botón Guardar -->
              <button
                pButton
                type="button"
                icon="pi pi-save"
                class="p-button-rounded p-button-text p-button-sm p-button-success"
                (click)="guardar(base, rowIndex)"
                [disabled]="!base.isEditing"
                pTooltip="Guardar"
                tooltipPosition="top">
              </button>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty message -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="7" class="text-center empty-message">
            <i class="pi pi-info-circle"></i>
            <p>No se encontraron bases de afectación</p>
          </td>
        </tr>
      </ng-template>
    </p-table>

  </p-panel>

</div>
