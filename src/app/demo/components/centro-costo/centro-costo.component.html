<div class="p-1 py-5 min-h-screen">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>
    
    <p-card header="Centro de costos" [styleClass]="'rounded-xl bg-white'">
        <div class="mb-4">
            <p-toolbar styleClass="bg-white border-none">
                <div class="p-toolbar-group-start">
                    <p-button 
                        label="Nuevo" 
                        icon="pi pi-plus" 
                        styleClass="p-button-sm p-button-info" 
                        (onClick)="agregarCentroCosto()"
                        [disabled]="!!editingCentroCosto">
                    </p-button>
                </div>
                
                <div class="p-toolbar-group-end">
                    <div class="flex align-items-center">
                        <label for="rowsPerPageTable" >Filas por página: </label>
                        <p-dropdown id="rowsPerPageTable" 
                                    [options]="[10, 20, 40]" 
                                    [(ngModel)]="rowsPerPage" 
                                    placeholder="10" 
                                    styleClass="p-button-sm w-16 text-center">
                        </p-dropdown>
                    </div>
                </div>
            </p-toolbar>
        </div>
        
        <div class="px-4">
            <p-table 
                [value]="centrosCosto" 
                [rows]="rowsPerPage" 
                [paginator]="true" 
                responsiveLayout="scroll"
                styleClass="p-datatable-sm"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 20%; text-align: center;">Código</th>
                        <th style="width: 40%; text-align: center;">Descripción</th>
                        <th style="width: 15%; text-align: center;">Activo</th>
                        <th style="width: 15%; text-align: center;">Acciones</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-centroCosto>
                    <tr>
                        <td class="text-center">
                            <div *ngIf="editingCentroCosto?.pla57codigo === centroCosto.pla57codigo; else displayCodigo">
                                <input pInputText type="text" 
                                    [(ngModel)]="editingCentroCosto!.pla57codigo" 
                                    placeholder="Código"
                                    class="w-full text-sm text-center font-bold"
                                    [disabled]="!isAddMode" 
                                    style="text-transform: uppercase;" /> 
                            </div>
                            <ng-template #displayCodigo>
                                {{ centroCosto.pla57codigo.startsWith('TEMP-') ? '---' : centroCosto.pla57codigo }}
                            </ng-template>
                        </td>

                        <td class="text-center">
                            <div *ngIf="editingCentroCosto?.pla57codigo === centroCosto.pla57codigo; else displayDescripcion">
                                <input pInputText type="text" 
                                    [(ngModel)]="editingCentroCosto!.pla57descripcion" 
                                    class="w-full text-sm text-left" />
                            </div>
                            <ng-template #displayDescripcion>
                                {{ centroCosto.pla57descripcion }}
                            </ng-template>
                        </td>

                        <td class="text-center">
                            <div *ngIf="editingCentroCosto?.pla57codigo === centroCosto.pla57codigo; else displayActivoVisual">
                                <p-checkbox [binary]="true" [(ngModel)]="editingCentroCosto!.pla57flagactivo"></p-checkbox>
                            </div>

                            <ng-template #displayActivoVisual>
                                <p-checkbox [binary]="true" [ngModel]="centroCosto.pla57flagactivo" [disabled]="true"
                                    [readonly]="true">
                                </p-checkbox>
                            </ng-template>
                        </td>

                        <td>
                            <div class="flex justify-content-center gap-2">

                                <div *ngIf="editingCentroCosto?.pla57codigo === centroCosto.pla57codigo">
                                    <p-button
                                        icon="pi pi-check"
                                        styleClass="p-button-sm p-button-success"
                                        pTooltip="Guardar"
                                        [text]="true"
                                        (onClick)="onRowGuardarEdicion(centroCosto)">
                                    </p-button>
                                    <p-button 
                                        icon="pi pi-times" 
                                        styleClass="p-button-sm p-button-danger p-button-text" 
                                        pTooltip="Cancelar"
                                        [text]="true"
                                        (onClick)="onRowCancelarEdicion(centroCosto)">
                                    </p-button>
                                </div>

                                <div *ngIf="editingCentroCosto?.pla57codigo !== centroCosto.pla57codigo">
                                    <p-button
                                        icon="pi pi-pencil"
                                        styleClass="p-button-sm p-button-info p-button-text"
                                        pTooltip="Editar"
                                        (onClick)="onRowEditarCentroCosto(centroCosto)"  
                                        [text]="true"
                                        [disabled]="!!editingCentroCosto">
                                    </p-button>
                                    <p-button 
                                        icon="pi pi-trash" 
                                        styleClass="p-button-sm p-button-danger p-button-text" 
                                        pTooltip="Eliminar"
                                        [text]="true"
                                        (onClick)="eliminarCentroCosto(centroCosto)"
                                        [disabled]="!!editingCentroCosto">
                                    </p-button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </ng-template>
                
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="4" style="text-align: center;">
                            No se encontraron cargos.
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </p-card>
</div>