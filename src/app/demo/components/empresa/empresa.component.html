<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="p-1 py-5 max-h-screen">
    <div class="mb-4">
        <p-card header="Empresas" styleClass="shadow-xl rounded-xl">

            <p-toolbar styleClass="mb-4 surface-card border-none px-4">
                <div class="p-toolbar-group-start flex flex-wrap gap-3">
                    <button pButton pRipple type="button" label="Nuevo" icon="pi pi-plus" class="p-button-success"
                        (click)="agregarEmpresa()" [disabled]="!isViewMode">
                    </button>
                    <button pButton pRipple type="button" label="Modificar" icon="pi pi-pencil" class="p-button-warning"
                        (click)="editarEmpresa()" [disabled]="!isViewMode || !selectedEmpresa">
                    </button>
                    <button pButton pRipple type="button" label="Eliminar" icon="pi pi-trash" class="p-button-danger"
                        (click)="eliminarEmpresa()" [disabled]="!isViewMode || !selectedEmpresa">
                    </button>

                    <button pButton pRipple type="button" label="Ver" icon="pi pi-search" class="p-button-info"
                        (click)="verEmpresa()" [disabled]="true">
                    </button>
                    <button pButton pRipple type="button" label="Refrescar la lista" icon="pi pi-refresh"
                        class="p-button-secondary" (click)="refrescarEmpresa()" [disabled]="!isViewMode">
                    </button>
                </div>

                <div class="p-toolbar-group-start flex flex-wrap gap-3">
                    <div class="p-toolbar-group-start flex flex-wrap gap-2 pr-1" *ngIf="isAddMode || isEditMode">
                        <button pButton pRipple type="button" icon="pi pi-save" class="p-button-primary"
                            (click)="guardar()" label="Guardar">
                        </button>
                        <button pButton pRipple type="button" icon="pi pi-times" class="p-button-secondary"
                            (click)="cancelar()" label="Cancelar">
                        </button>
                    </div>

                    <div class="p-toolbar-group-end">
                        <div class="flex align-items-center">
                            <label for="rowsPerPageTable">Filas por página:</label>
                            <p-dropdown id="rowsPerPageTable" [options]="[10, 20, 40]" [(ngModel)]="rowsPerPage"
                                placeholder="10" styleClass="p-button-sm w-16 text-center">
                            </p-dropdown>
                        </div>
                    </div>
                </div>
            </p-toolbar>

            <div *ngIf="isViewMode" class="px-4 py-3">
                <div class="relative">
                    <div *ngIf="loading" class="absolute inset-0 z-2 flex align-items-center border-round">
                        <p-progressSpinner styleClass="w-3rem h-3rem" strokeWidth="5" animationDuration=".5s">

                        </p-progressSpinner>
                    </div>

                    <p-table [value]="empresas" selectionMode="single" [(selection)]="selectedEmpresa"
                        dataKey="empresacod" styleClass="p-datatable-sm" [paginator]="true" [rows]="rowsPerPage"
                        responsiveLayout="scroll">

                        <ng-template pTemplate="paginatorcenter" let-state>
                        </ng-template>

                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width:15%; text-align: center;">Código</th>
                                <th style="width:15%; text-align: center;">RUC</th>
                                <th style="width:35%; text-align: center;">Razón Social</th>
                                <th style="width:45%; text-align: center;">Dirección</th>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="body" let-empresa>
                            <tr [pSelectableRow]="empresa">
                                <td class="text-center">{{ empresa.empresacod }}</td>
                                <td class="text-center">{{ empresa.ruc }}</td>
                                <td class="text-center">{{ empresa.razonsocial }}</td>
                                <td class="text-center">{{ empresa.direccion }}</td>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="4" class="text-center">No se encontraron empresas.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>

            <div *ngIf="isAddMode || isEditMode">

                <div class="grid gap-2 justify-content-center py-1 px-4">
                    <div class="col-12 md:col-12 justify-content-center ">
                        <p-panel header="Datos de la Empresa" [toggleable]="false" styleClass="border-round">

                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="codigo" [(ngModel)]="empresa.empresacod"
                                            [disabled]="isDisabled() || isEditMode" class="w-full" />
                                        <label for="codigo">Código</label>
                                    </span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="ruc" [(ngModel)]="empresa.ruc" [disabled]="isDisabled()"
                                            class="w-full" />
                                        <label for="ruc">RUC</label>
                                    </span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="razonSocial" [(ngModel)]="empresa.razonsocial"
                                            [disabled]="isDisabled()" class="w-full" />
                                        <label for="razonSocial">Razón Social</label>
                                    </span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="direccion" [(ngModel)]="empresa.direccion"
                                            [disabled]="isDisabled()" class="w-full" />
                                        <label for="direccion">Dirección</label>
                                    </span>
                                </div>
                            </div>

                        </p-panel>
                    </div>
                </div>

                <div class="grid gap-2 mb-3 px-3 py-1 justify-content-between">

                    <div class="col-12 md:col-6 p-3">
                        <p-panel header="Representante Legal" [toggleable]="false" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1">
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="docTipos" optionLabel="label" optionValue="value"
                                                [(ngModel)]="empresa.representanteLegal.replegaldoctip"
                                                placeholder="Seleccione Tipo Doc" [filter]="true" [showClear]="true"
                                                styleClass="w-full"
                                                appendTo="body"
                                                [class.p-filled]="empresa.representanteLegal.replegaldoctip"
                                                id="docTipoRL" [disabled]="isDisabled()"></p-dropdown>
                                            <label for="docTipoRL">Tipo Documento</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="docNroRL"
                                                [(ngModel)]="empresa.representanteLegal.replegaldocnro" class="w-full"
                                                [disabled]="isDisabled()" />
                                            <label for="docNroRL">Doc. Nro</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apPaternoRL"
                                                [(ngModel)]="empresa.representanteLegal.replegalapepaterno"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="apPaternoRL">Apellido Paterno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apMaternoRL"
                                                [(ngModel)]="empresa.representanteLegal.replegalapematerno"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="apMaternoRL">Apellido Materno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="nombresRL"
                                                [(ngModel)]="empresa.representanteLegal.replegalnombres" class="w-full"
                                                [disabled]="isDisabled()" />
                                            <label for="nombresRL">Nombres</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>

                    <div class="col-12 md:col-5 p-3">
                        <p-panel header="Responsable Planilla" [toggleable]="false" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1">
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="docTipos" optionLabel="label" optionValue="value"
                                                [(ngModel)]="empresa.responsablePlanilla.encargadoplanilladoctip"
                                                placeholder="Seleccione Tipo Doc" [filter]="true" [showClear]="true"
                                                styleClass="w-full"
                                                appendTo="body"
                                                [class.p-filled]="empresa.responsablePlanilla.encargadoplanilladoctip"
                                                id="docTipoRP" [disabled]="isDisabled()"></p-dropdown>
                                            <label for="docTipoRP">Doc. Tipo</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="docNroRP"
                                                [(ngModel)]="empresa.responsablePlanilla.encargadoplanilladocnro"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="docNroRP">Doc. Nro</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apPaternoRP"
                                                [(ngModel)]="empresa.responsablePlanilla.encargadoplanillaapepaterno"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="apPaternoRP">Ap. Paterno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apMaternoRP"
                                                [(ngModel)]="empresa.responsablePlanilla.encargadoplanillaapematerno"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="apMaternoRP">Ap. Materno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="nombresRP"
                                                [(ngModel)]="empresa.responsablePlanilla.encargadoplanillanombres"
                                                class="w-full" [disabled]="isDisabled()" />
                                            <label for="nombresRP">Nombres</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>

                <div class="grid mb-5 px-4 py-0">
                    <div class="col-12">
                        <p-panel header="Bancos" [toggleable]="false" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1">
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="bancosOptions" optionLabel="label"
                                                optionValue="value" [(ngModel)]="empresa.bancos.ctasolespagobancocod"
                                                placeholder="Seleccione Banco" [filter]="true" [showClear]="true"
                                                styleClass="w-full"
                                                [class.p-filled]="empresa.bancos.ctasolespagobancocod" id="bancoSoles"
                                                [disabled]="isDisabled()"></p-dropdown>
                                            <label for="bancoSoles">Banco Soles</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="ctaSoles"
                                                [(ngModel)]="empresa.bancos.ctasolespagonumero" class="w-full"
                                                [disabled]="isDisabled()" />
                                            <label for="ctaSoles">Nro. Cuenta Soles</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="bancosOptions" optionLabel="label"
                                                optionValue="value" [(ngModel)]="empresa.bancos.ctadolarespagobancocod"
                                                placeholder="Seleccione Banco" [filter]="true" [showClear]="true"
                                                styleClass="w-full"
                                                [class.p-filled]="empresa.bancos.ctadolarespagobancocod"
                                                id="bancoDolares" [disabled]="isDisabled()"></p-dropdown>
                                            <label for="bancoDolares">Banco Dólares</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="ctaDolares"
                                                [(ngModel)]="empresa.bancos.ctadolarespagonumero" class="w-full"
                                                [disabled]="isDisabled()" />
                                            <label for="ctadolares">Nro. Cuenta Dólares</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div>
            </div>
        </p-card>
    </div>
</div>