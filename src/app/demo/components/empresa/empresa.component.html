<div class="min-h-screen flex justify-content-center py-5 px-3">
    <div class="w-full xl:w-11">
        <p-card header="Empresas" styleClass="shadow-2 border-round"> 

            <p-toast></p-toast>
            <p-confirmDialog></p-confirmDialog>

            <p-panel header="Acciones" [toggleable]="true" styleClass="h-full border-round px-5">
            <p-toolbar styleClass="mb-3 surface-card border-none">
                <div class="p-toolbar-group-start flex flex-wrap gap-2">
                    <button pButton pRipple type="button" label="Agregar" icon="pi pi-plus" class="p-button-success" (click)="agregarEmpresa()" [disabled]="mode !== 'view'"></button>
                    <button pButton pRipple type="button" label="Modificar" icon="pi pi-pencil" class="p-button-warning" (click)="editarEmpresa()" [disabled]="mode !== 'view' || !selectedEmpresa"></button>
                    <button pButton pRipple type="button" label="Eliminar" icon="pi pi-trash" class="p-button-danger" (click)="eliminarEmpresa()" [disabled]="mode !== 'view' || !selectedEmpresa"></button>
                    
                    <button pButton pRipple type="button" label="Buscar" icon="pi pi-search" class="p-button-info" (click)="buscarEmpresa()" [disabled]="true"></button>
                    <button pButton pRipple type="button" label="Refrescar la lista" icon="pi pi-refresh" class="p-button-secondary" (click)="refrescarEmpresa()"></button>
                </div>

                <div class="p-toolbar-group-end flex flex-wrap gap-2 pr-1" *ngIf="mode !== 'view'">
                    <button pButton pRipple type="button" icon="pi pi-save" class="p-button-primary" (click)="guardar()" label="Guardar"></button>
                    <button pButton pRipple type="button" icon="pi pi-times" class="p-button-secondary" (click)="cancelar()" label="Cancelar"></button>
                </div>
            </p-toolbar>
            </p-panel>

            <div *ngIf="mode === 'view'" class="px-5 py-1">
                
                <div class="relative"> 
                             
                    <div *ngIf="loading" 
                         class="absolute inset-0 z-5 flex align-items-end justify-content-center border-round" 
                         >
                        <p-progressSpinner styleClass="w-4rem h-4rem" strokeWidth="5" animationDuration=".5s"></p-progressSpinner>
                    </div>

                    <div class="flex justify-content-end mb-3">
                        <div class="flex align-items-center">
                            <label for="rowsPerPageTable" class="mr-2 text-sm">Filas por página:</label>
                            <p-dropdown id="rowsPerPageTable" 
                                        [options]="[10, 20, 40]" 
                                        [(ngModel)]="rowsPerPage" 
                                        placeholder="Seleccionar" 
                                        class="p-button-sm">
                            </p-dropdown>
                        </div>
                    </div>

                    <p-table [value]="empresas" selectionMode="single" [(selection)]="selectedEmpresa" dataKey="EmpresaCod"
                            [tableStyle]="{'min-width': '50rem'}" styleClass="p-datatable-sm" 
                            [paginator]="true" [rows]="rowsPerPage"  
                            paginatorPosition="bottom">

                        <ng-template pTemplate="paginatorcenter" let-state>
                        </ng-template>
                        
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width:15%; text-align: center;">Código</th>
                                <th style="width:15%; text-align: center;">RUC</th>
                                <th style="width:35%; text-align: center;">Razón Social</th>
                                <th style="width:45%; text-align: center;">Dirección</th>
                            </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="body" let-empresa>
                            <tr [pSelectableRow]="empresa">
                                <td style="text-align: center;">{{ empresa.EmpresaCod }}</td>
                                <td style="text-align: center;">{{ empresa.RUC }}</td>
                                <td style="text-align: center;">{{ empresa.RazonSocial }}</td>
                                <td style="text-align: center;">{{ empresa.Direccion }}</td>
                            </tr>
                        </ng-template>
                        
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="4" class="text-center">No se encontraron empresas.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div> </div>
            
            <div *ngIf="mode !== 'view'"> 
                
                <div class="grid gap-2 justify-content-center py-4 px-4"> 
                    <div class="col-12 md:col-12 justify-content-center ">
                        <p-panel header="Datos de la Empresa" [toggleable]="true" styleClass="border-round">
                            
                            <div class="col-12"> 
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="codigo" [(ngModel)]="empresa.EmpresaCod" 
                                        [disabled]="isDisabled() || mode === 'edit'" 
                                        class="w-full" />
                                        <label for="codigo">Código</label>
                                    </span>
                                </div>
                            </div>

                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="ruc" [(ngModel)]="empresa.RUC" 
                                        [disabled]="isDisabled()" 
                                        class="w-full" />
                                        <label for="ruc">RUC</label>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="col-12"> 
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="razonSocial" 
                                        [(ngModel)]="empresa.RazonSocial" 
                                        [disabled]="isDisabled()" 
                                        class="w-full" />
                                        <label for="razonSocial">Razón Social</label>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="field">
                                    <span class="p-float-label">
                                        <input pInputText id="direccion" 
                                        [(ngModel)]="empresa.Direccion" 
                                        [disabled]="isDisabled()" 
                                        class="w-full" />
                                        <label for="direccion">Dirección</label>
                                    </span>
                                </div>
                            </div>
                        
                        </p-panel>
                    </div> 
                </div>
                
                <div class="grid gap-2 mb-3 px-3 py-1 justify-content-between"> 
                    
                    <div class="col-12 md:col-6 p-3">
                        <p-panel header="Representante Legal" [toggleable]="true" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1"> 
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="docTipos" optionLabel="label" optionValue="value" 
                                                        [(ngModel)]="empresa.representanteLegal.RepLegalDocTip" placeholder="Seleccione Tipo Doc" 
                                                        [filter]="true" [showClear]="true" styleClass="w-full" 
                                                        [class.p-filled]="empresa.representanteLegal.RepLegalDocTip" 
                                                        id="docTipoRL"></p-dropdown>
                                            <label for="docTipoRL">Tipo Documento</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="docNroRL"
                                             [(ngModel)]="empresa.representanteLegal.RepLegalDocNro" 
                                             class="w-full" />
                                            <label for="docNroRL">Doc. Nro</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apPaternoRL" 
                                            [(ngModel)]="empresa.representanteLegal.RepLegalApePaterno" 
                                            class="w-full" />
                                            <label for="apPaternoRL">Apellido Paterno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apMaternoRL" [(ngModel)]="empresa.representanteLegal.RepLegalApeMaterno" class="w-full" />
                                            <label for="apMaternoRL">Apellido Materno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="nombresRL" [(ngModel)]="empresa.representanteLegal.RepLegalNombres" class="w-full" />
                                            <label for="nombresRL">Nombres</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>

                    <div class="col-12 md:col-5 p-3"> 
                        <p-panel header="Responsable Planilla" [toggleable]="true" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1">
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="docTipos" optionLabel="label" optionValue="value" 
                                                        [(ngModel)]="empresa.responsablePlanilla.EncargadoPlanillaDocTip" placeholder="Seleccione Tipo Doc" 
                                                        [filter]="true" [showClear]="true" styleClass="w-full" 
                                                        [class.p-filled]="empresa.responsablePlanilla.EncargadoPlanillaDocTip" id="docTipoRP"></p-dropdown>
                                            <label for="docTipoRP">Doc. Tipo</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="docNroRP" [(ngModel)]="empresa.responsablePlanilla.EncargadoPlanillaDocNro" class="w-full" />
                                            <label for="docNroRP">Doc. Nro</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apPaternoRP" [(ngModel)]="empresa.responsablePlanilla.EncargadoPlanillaApePaterno" class="w-full" />
                                            <label for="apPaternoRP">Ap. Paterno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="apMaternoRP" [(ngModel)]="empresa.responsablePlanilla.EncargadoPlanillaApeMaterno" class="w-full" />
                                            <label for="apMaternoRP">Ap. Materno</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="nombresRP" [(ngModel)]="empresa.responsablePlanilla.EncargadoPlanillaNombres" class="w-full" />
                                            <label for="nombresRP">Nombres</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div> <div class="grid mb-5 px-4 py-0">
                    <div class="col-12">
                        <p-panel header="Bancos" [toggleable]="true" styleClass="h-full border-round">
                            <div class="grid formgrid gap-2 pt-3 px-1">
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="bancosOptions" optionLabel="label" optionValue="value" 
                                                        [(ngModel)]="empresa.bancos.CtaSolesPagoBancoCod" placeholder="Seleccione Banco" 
                                                        [filter]="true" [showClear]="true" styleClass="w-full" 
                                                        [class.p-filled]="empresa.bancos.CtaSolesPagoBancoCod" id="bancoSoles"></p-dropdown>
                                            <label for="bancoSoles">Banco Soles</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="ctaSoles" [(ngModel)]="empresa.bancos.CtaSolesPagoNumero" class="w-full" />
                                            <label for="ctaSoles">Nro. Cuenta Soles</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <p-dropdown [options]="bancosOptions" optionLabel="label" optionValue="value" 
                                                        [(ngModel)]="empresa.bancos.CtaDolaresPagoBancoCod" placeholder="Seleccione Banco" 
                                                        [filter]="true" [showClear]="true" styleClass="w-full" 
                                                        [class.p-filled]="empresa.bancos.CtaDolaresPagoBancoCod" id="bancoDolares"></p-dropdown>
                                            <label for="bancoDolares">Banco Dólares</label>
                                        </span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="field">
                                        <span class="p-float-label">
                                            <input pInputText id="ctaDolares" [(ngModel)]="empresa.bancos.CtaDolaresPagoNumero" class="w-full" />
                                            <label for="ctaDolares">Nro. Cuenta Dólares</label>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </p-panel>
                    </div>
                </div> </div> </p-card>
    </div>
</div>