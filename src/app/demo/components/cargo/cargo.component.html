<div class="p-1 py-5 min-h-screen">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <p-card header="Cargos" [styleClass]="'rounded-xl bg-white'">
        <div class="mb-4">
            <p-toolbar styleClass="bg-white border-none">
                <div class="p-toolbar-group-start">
                    <p-button label="Nuevo" icon="pi pi-plus" styleClass="p-button-sm p-button-info"
                        (onClick)="agregarCargo()" [disabled]="!!editingCargo">
                    </p-button>
                </div>

                <div class="p-toolbar-group-end">
                    <div class="flex align-items-center">
                        <label for="rowsPerPageTable">Filas por página: </label>
                        <p-dropdown id="rowsPerPageTable" [options]="[10, 20, 40]" [(ngModel)]="rowsPerPage"
                            placeholder="10" styleClass="p-button-sm w-16 text-center">
                        </p-dropdown>
                    </div>
                </div>
            </p-toolbar>
        </div>

        <div class="px-4">
            <p-table [value]="cargos" [rows]="rowsPerPage" [paginator]="true" responsiveLayout="scroll"
                styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 20%; text-align: center;">Código</th>
                        <th style="width: 40%; text-align: center;">Descripción</th>
                        <th style="width: 15%; text-align: center;">Activo</th>
                        <th style="width: 15%; text-align: center;">Acciones</th>
                    </tr>
                </ng-template>

                <ng-template pTemplate="body" let-cargo>
                    <tr>
                        <td class="text-center">
                            <div *ngIf="editingCargo?.pla51codigo === cargo.pla51codigo; else displayCodigo">
                                <input pInputText type="text" [(ngModel)]="editingCargo!.pla51codigo"
                                    placeholder="Código" class="w-full text-sm text-center font-bold"
                                    [disabled]="!isAddMode" style="text-transform: uppercase;" />
                            </div>
                            <ng-template #displayCodigo>
                                {{ cargo.pla51codigo.startsWith('TEMP-') ? '---' : cargo.pla51codigo }}
                            </ng-template>
                        </td>

                        <td class="text-center">
                            <div *ngIf="editingCargo?.pla51codigo === cargo.pla51codigo; else displayDescripcion">
                                <input pInputText type="text" [(ngModel)]="editingCargo!.pla51descripcion"
                                    class="w-full text-sm text-left" />
                            </div>
                            <ng-template #displayDescripcion>
                                {{ cargo.pla51descripcion }}
                            </ng-template>
                        </td>

                        <td class="text-center">
                            <div *ngIf="editingCargo?.pla51codigo === cargo.pla51codigo; else displayActivoVisual">
                                <p-checkbox [binary]="true" [(ngModel)]="editingCargo!.pla51flagactivo"></p-checkbox>
                            </div>

                            <ng-template #displayActivoVisual>
                                <p-checkbox [binary]="true" [ngModel]="cargo.pla51flagactivo" [disabled]="true"
                                    [readonly]="true">
                                </p-checkbox>
                            </ng-template>
                        </td>

                        <td>
                            <div class="flex justify-content-center gap-2">

                                <div *ngIf="editingCargo?.pla51codigo === cargo.pla51codigo">
                                    <p-button icon="pi pi-check" styleClass="p-button-sm p-button-success"
                                        pTooltip="Guardar" [text]="true" (onClick)="onRowGuardarEdicion(cargo)">
                                    </p-button>
                                    <p-button icon="pi pi-times" styleClass="p-button-sm p-button-danger p-button-text"
                                        pTooltip="Cancelar" [text]="true" (onClick)="onRowCancelarEdicion(cargo)">
                                    </p-button>
                                </div>

                                <div *ngIf="editingCargo?.pla51codigo !== cargo.pla51codigo">
                                    <p-button icon="pi pi-pencil" styleClass="p-button-sm p-button-info p-button-text"
                                        pTooltip="Editar" (onClick)="onRowEditarCargo(cargo)"   [text]="true"
                                        [disabled]="!!editingCargo">
                                    </p-button>
                                    <p-button icon="pi pi-trash" styleClass="p-button-sm p-button-danger p-button-text"
                                        pTooltip="Eliminar" [text]="true" (onClick)="eliminarCargo(cargo)"
                                        [disabled]="!!editingCargo">
                                    </p-button>
                                </div>
                            </div>
                        </td>
                    </tr>
                </ng-template>

                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="4" style="text-align: center;">
                            No se encontraron cargos.
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </p-card>
</div>