<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="p-1 py-5 max-h-screen">
  <div class="mb-2">
    <p-panel header="Trabajador" styleClass="shadow-xl rounded-xl mb-3">
      <div class="flex justify-content-between align-items-center mb-3">
        <button type="button" pButton icon="pi pi-plus" label="Nuevo Trabajador"
        (click)="nuevoTrabajador()"
        class="p-button-sm"></button>
        <div class="flex align-items-center">
          <label for="rowsPerPage" class="mr-2">Filas por página:</label>
          <p-dropdown id="rowsPerPage" [options]="[10, 20, 40]" [(ngModel)]="rowsPerPage" placeholder="Seleccionar" class="p-button-sm"></p-dropdown>
        </div>
      </div>

      <p-table
      [value]="trabajadorList"
      dataKey="pla01empresacod"
      [paginator]="true"
      [rows]="rowsPerPage"
      responsiveLayout="scroll"
      styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines">
        <!-- Cabecera-->
        <ng-template pTemplate="header">
          <tr>
            <th style="text-align: center; width: 10%;">Código</th>
            <th style="text-align: center; width: 10%;">Doc. Identidad</th>
            <th style="text-align: center; width: 15%;">Apellidos y Nombres</th>
            <th style="text-align: center; width: 15%;">Dirección</th>
            <th style="text-align: center; width: 10%;">Fec. Nac.</th>
            <th style="text-align: center; width: 10%;">Teléfono</th>
            <th style="text-align: center; width: 10%;">Fec. Ingreso</th>
            <th style="text-align: center; width: 10%;">Centro costo</th>
            <th style="text-align: center; width: 10%;">Acciones</th>
          </tr>
        </ng-template>
        <!-- Cuerpo -->
        <ng-template pTemplate="body" let-trabajador>
          <tr>
            <td>{{trabajador.pla01empleadocod}}</td>
            <td>{{trabajador.pla01docuidentidadnro}}</td>
            <td>{{trabajador.apellidosynombres}}</td>
            <td>{{trabajador.pla01direccion}}</td>
            <td>{{trabajador.pla01fechanacimiento | date: 'dd/MM/yyyy'}}</td>
            <td>{{trabajador.pla01telefono}}</td>
            <td>{{trabajador.pla01fechaingreso | date: 'dd/MM/yyyy'}}</td>
            <td>{{trabajador.pla01centrocosto}}</td>
            <td>
              <div class="flex justify-content-center gap-2">

                <!-- Botón Ver Detalle -->

                <button pButton
                type="button"
                icon="pi pi-eye"
                pTooltip="Ver Detalle"
                (click)="verTrabajador(trabajador)"
                class="p-button-rounded p-button-text p-button-sm"></button>

                <!-- Botón Editar -->
                <button pButton
                (click)="editarTrabajador(trabajador)"
                icon="pi pi-pencil"
                pTooltip="Editar"
                class="p-button-rounded p-button-text p-button-sm"
                ></button>

                <!-- Botón Eliminar -->
                <button pButton
                type="button"
                (click)="eliminarTrabajador(trabajador)"
                icon="pi pi-trash"
                pTooltip="Eliminar"
                class="p-button-rounded p-button-text p-button-sm p-button-danger"></button>

              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-panel>
  </div>

</div>

<!-- Diálogo de Detalle -->
<p-dialog
[(visible)]="displayDialog"
[header]="'Detalle del trabajador'"
[style]="{width: '95vw', height: '90vh'}"
[modal]="true"
[draggable]="false"
[resizable]="false"
[closable]="false">
  <form [formGroup]="trabajadorForm">
    <!-- Detalles superiores -->
    <div class="grid gap-3">
      <!-- Código -->
       <div class="col-12 md:col-6 lg:col-3">
        <label>Código</label>
        <input type="text" pInputText formControlName="pla01empleadocod" placeholder="Código" class="w-full" readonly label="Código"/>
       </div>

       <!-- Tipo de Documento -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>DocTipo :</label>
        <input type="text" pInputText formControlName="pla01docuidentidadtipo" [disabled]="true" class="w-full" />
      </div>

      <!-- Número de Documento -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>DocNro :</label>
        <input type="text" pInputText formControlName="pla01docuidentidadnro" [disabled]="true" class="w-full" />
      </div>

      <!-- Apellido Paterno -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Ape.Paterno :</label>
        <input type="text" pInputText formControlName="pla01apepaterno" class="w-full" />
      </div>

      <!-- Apellido Materno -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Ape.Materno :</label>
        <input type="text" pInputText formControlName="pla01apematerno" class="w-full" />
      </div>

      <!-- Nombres -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Nombres :</label>
        <input type="text" pInputText formControlName="pla01nombre1" class="w-full" />
      </div>

      <!-- Fecha de Nacimiento -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Fec.Nac :</label>
        <p-calendar formControlName="pla01fechanacimiento" dateFormat="dd/mm/yy" class="w-full"></p-calendar>
      </div>

      <!-- Sexo -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Sexo :</label>
        <div class="flex gap-2">
          <p-radioButton formControlName="pla01sexo" label="M" [value]="'M'"></p-radioButton>
          <p-radioButton formControlName="pla01sexo" label="F" [value]="'F'"></p-radioButton>
        </div>
      </div>

      <!-- Régimen Laboral -->
      <div class="col-12 md:col-6 lg:col-3">
        <label>Reg.Laboral :</label>
        <!--<input type="text" pInputText formControlName="pla01regimenlaboral" [disabled]="true" class="w-full" />-->

        <input type="text" pInputText formControlName="pla01trdatoslabregimenlaboral"
        readonly maxlength="2" style="width: 60px" />
        <input type="text" pInputText formControlName="labregimenlaboraldes"
        readonly class="w-full"/>
        <button pButton type="button" icon="pi pi-search" class="p-button-sm"
        [disabled]="esModoVisualizacion" (click)="abrirBusquedaRegLaboral()"></button>
      </div>
    </div>
  </form>
  <ng-template pTemplate="footer">
    <button pButton type="button" [label]="esModoVisualizacion ? 'Cerrar' : 'Cancelar'" icon="pi pi-times"
    class="p-button-secondary" (click)="cerrarTrabajador()"></button>

    <button *ngIf="!esModoVisualizacion" pButton type="button" label="Guardar" icon="pi pi-check"
    class="p-button-success" (click)="guardarTrabajador()"></button>

  </ng-template>
</p-dialog>
