<div class="p-1 py-5 min-h-screen">
    <p-toast></p-toast>
    <p-confirmDialog></p-confirmDialog>

    <div class="mb-2">
        <p-panel header="Establecimiento" styleClass="shadow-xl rounded-xl">
            <div class="aligned-content-container">
                <div class="mb-2">
                    <p-toolbar styleClass="bg-white border-none">
                        <div class="p-toolbar-group-start">
                            <p-button label="Nuevo" icon="pi pi-plus" styleClass="p-button-sm"
                                (onClick)="agregarEstablecimiento()" [disabled]="!!editingEstablecimiento">
                            </p-button>
                        </div>

                        <!--<div class="table-controls-header flex justify-content-end align-items-center pr-1">
                            <div class="flex align-items-center">
                                <label style="margin-right: 0.5rem; font-size: 15px;" for="rowsPerPageTable">Filas por
                                    página:</label>
                                <p-dropdown id="rowsPerPageTable" [options]="[10, 20, 40]" appendTo="body"
                                    [(ngModel)]="rowsPerPage" placeholder="10"
                                    styleClass="p-button-sm w-16 text-center">
                                </p-dropdown>
                            </div>
                        </div> -->
                    </p-toolbar>
                </div>

                <!-- Contenedor de la Tabla -->
                <div class="px-4">
                    <p-table [value]="establecimientos" [rows]="rowsPerPage" [paginator]="true"
                        responsiveLayout="scroll" [rowsPerPageOptions]="[5, 10, 20, 50]"
                        styleClass="p-datatable-sm p-datatable-striped p-datatable-gridlines establecimiento-table">
                        <!-- Encabezado de la Tabla -->
                        <ng-template pTemplate="header">
                            <tr>
                                <th style="width: auto; text-align: center;">Código</th>
                                <th style="width: auto; text-align: center;">Denominación</th>
                                <th style="width: auto; text-align: center;">EstablecimientoTipoDes</th>
                                <th style="width: auto; text-align: center;">SCRT</th>
                                <th style="width: auto; text-align: center;">SCTR - Tasa</th>
                                <th style="width: auto; text-align: center;">Acciones</th>
                            </tr>
                        </ng-template>

                        <!-- Cuerpo de la Tabla (Edición en línea) -->
                        <ng-template pTemplate="body" let-establecimiento>
                            <tr>
                                <!-- Columna Código -->
                                <td class="text-center">
                                    <div
                                        *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo; else displayCodigo">
                                        <input pInputText type="text" [(ngModel)]="editingEstablecimiento!.pla20codigo"
                                            placeholder="Código" class="w-full text-sm text-center font-bold"
                                            [disabled]="!isAddMode" />
                                    </div>
                                    <ng-template #displayCodigo>
                                        {{ establecimiento.pla20codigo }}
                                    </ng-template>
                                </td>

                                <!-- Columna Denominación -->
                                <td class="text-center">
                                    <div
                                        *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo; else displayDenominacion">
                                        <input pInputText type="text"
                                            [(ngModel)]="editingEstablecimiento!.pla20denominacion"
                                            class="w-full text-sm text-center" />
                                    </div>
                                    <ng-template #displayDenominacion>
                                        {{ establecimiento.pla20denominacion }}
                                    </ng-template>
                                </td>

                                <!-- Columna Tipo de Establecimiento -->
                                <td class="text-center">
                                    <div
                                        *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo; else displayTipo">
                                        <p-dropdown [options]="tipoOptions" optionLabel="label" optionValue="value"
                                            [(ngModel)]="editingEstablecimiento!.pla20establecimientotipo"
                                            placeholder="Seleccionar Tipo" styleClass="w-full text-sm text-left"
                                            appendTo="body"></p-dropdown>
                                    </div>
                                    <ng-template #displayTipo>
                                        <span class="font-medium text-gray-700">
                                            {{ getEstablecimientoTipoLabel(establecimiento.pla20establecimientotipo)
                                            }}</span>
                                    </ng-template>
                                </td>

                                <!-- Columna SCTR Flag-->
                                <td class="text-center">
                                    <div
                                        *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo; else displayActivoVisual">
                                        <p-checkbox [binary]="true"
                                            [(ngModel)]="editingEstablecimiento!.pla20sctrflag"></p-checkbox>
                                    </div>

                                    <ng-template #displayActivoVisual>
                                        <p-checkbox [binary]="true" [ngModel]="establecimiento.pla20sctrflag"
                                            [disabled]="true" [readonly]="true">
                                        </p-checkbox>
                                    </ng-template>
                                </td>

                                <!-- Columna SCTR Tasa -->
                                <td class="text-center">
                                    <div
                                        *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo; else displaySctrTasa">
                                        <input pInputText type="number"
                                            [(ngModel)]="editingEstablecimiento!.pla20sctrtasa"
                                            [disabled]="!editingEstablecimiento!.pla20sctrflag" placeholder="0.00"
                                            class="w-full text-sm text-center" />
                                    </div>
                                    <ng-template #displaySctrTasa>
                                        <span
                                            *ngIf="establecimiento.pla20sctrflag && establecimiento.pla20sctrtasa !== null">
                                            {{ establecimiento.pla20sctrtasa | number:'1.2-2' }}</span>
                                    </ng-template>
                                </td>

                                <!-- Columna Acciones -->
                                <td>
                                    <div class="flex justify-content-center gap-2">
                                        <!-- Botones de Edición (Guardar/Cancelar) -->
                                        <div
                                            *ngIf="editingEstablecimiento?.pla20codigo === establecimiento.pla20codigo">
                                            <p-button icon="pi pi-check" styleClass="p-button-sm p-button-success"
                                                pTooltip="Guardar" [text]="true"
                                                (onClick)="onRowGuardarEdicion(establecimiento)">
                                            </p-button>
                                            <p-button icon="pi pi-times"
                                                styleClass="p-button-sm p-button-danger p-button-text"
                                                pTooltip="Cancelar" [text]="true"
                                                (onClick)="onRowCancelarEdicion(establecimiento)">
                                            </p-button>
                                        </div>

                                        <!-- Botones de vista (Editar/Eliminar) -->
                                        <div
                                            *ngIf="editingEstablecimiento?.pla20codigo !== establecimiento.pla20codigo">
                                            <p-button icon="pi pi-pencil"
                                                styleClass="p-button-sm p-button-info p-button-text" pTooltip="Editar"
                                                (onClick)="onRowEditarEstablecimiento(establecimiento)" [text]="true"
                                                [disabled]="!!editingEstablecimiento">
                                            </p-button>
                                            <p-button icon="pi pi-trash"
                                                styleClass="p-button-sm p-button-danger p-button-text"
                                                pTooltip="Eliminar" [text]="true"
                                                (onClick)="eliminarEstablecimiento(establecimiento)"
                                                [disabled]="!!editingEstablecimiento">
                                            </p-button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="6" style="text-align: center;">
                                    No se encontraron establecimientos.
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </p-panel>
    </div>
</div>